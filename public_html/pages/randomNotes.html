
<html>
    <head>
        <script src="../plugins/jquery.js" type="text/javascript"></script>
        <link rel="stylesheet" href="../plugins/bootstrap-4.4.1-dist/css/bootstrap.min.css">
        <script src="../plugins/bootstrap-4.4.1-dist/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="../styles/general.css">
        <script src="https://kit.fontawesome.com/2639085eae.js" crossorigin="anonymous"></script> 
        <script src="../Javascript/Scale.js" type="text/javascript"></script>
        <script src="../Javascript/Notes.js" type="text/javascript"></script>
        <script src="../Javascript/RandomNotes.js" type="text/javascript"></script>


    <body>
        <header> 
            <nav class = "navbar navbar-expand-lg navbar-dark bg-dark">
                <div class="container">
                    <a class = "navbar-brand mr-5" href = "index.html"><i class="fas fa-music"></i></a>
                    <button class = "navbar-toggler" type = "button" data-toggle = "collapse" data-target = "#navbarNavAltMarkup" aria-controls = "navbarNavAltMarkup" aria-expanded = "false" aria-label = "Toggle navigation">
                        <span class = "navbar-toggler-icon"></span>
                    </button>
                    <div class = "collapse navbar-collapse" id = "navbarNavAltMarkup">
                        <div class = "navbar-nav">
                            <a class = "nav-item nav-link " href = "createNewSequence.html"><span class="textNav">My scales</span></a>
                            <a class = "nav-item nav-link " href = "randomNotes.html"><span class="textNav">Notes generator</span></a>                      
                            <a class = "nav-item nav-link " href = "pianoVirtual.html"><span class="textNav">Virtual Piano</span></a>
                            <a class = "nav-item nav-link " href = "help.html"><span class="textNav">Help</span></a>
                        </div>                  
                    </div>
                </div>
            </nav>
            <script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/unique-methods/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script>
            <script type="text/javascript">window.dojoRequire(["mojo/signup-forms/Loader"], function (L) {
                    L.start({"baseUrl": "mc.us20.list-manage.com", "uuid": "dbcd725d81fa004cc7aa6230a", "lid": "673d85a600", "uniqueMethods": true})
                })</script>
        </header>
        <main>
            <div class="container"> 

                <h3 class="margin-item2">Configuration</h3>
                <div class="margin-main"> 
                    <h4>Basic</h4>
                    <div class="form-group">
                        <label>Tonic</label>
                        <select name="notes" id="notes" class="form-control">
                            <option value="C">C</option> 
                            <option value="C#">C#</option>
                            <option value="D">D</option>
                            <option value="D#">D#</option>
                            <option value="E">E</option>
                            <option value="F">F</option>
                            <option value="F#">F#</option>
                            <option value="G">G</option>
                            <option value="G#">G#</option>
                            <option value="A">A</option>
                            <option value="A#">A#</option>
                            <option value="B">B</option>                             
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Scale (sequence)</label>
                        <select name="sequence" id="sequence" class="form-control">

                        </select>
                    </div>

                    <button id="btnEdit" type="button" value="1" class="btn btn-primary">edit</button>
                    <hr>
                    <h4 class="margin-item2">Probabilities</h4>
                    <div class="margin-main"> 
                        <label>Next Note (%)</label>
                        <div class="input-group sm-12 margin-main">
                            <input type="number" id="p1" class="form-control prob" placeholder="next Note" aria-label="next Note" aria-describedby="basic-addon2"  min="0" max="100" disabled>
                            <div class="input-group-append">
                                <span class="input-group-text" id="basic-addon2" >0~100</span>
                                <button id="btnFix1" type="button" class="btn btn-primary" onclick="fixInput('#p1')">fix</button>
                            </div>
                        </div>
                        <label>Previous Note (%)</label>
                        <div class="input-group sm-12 margin-main">
                            <input type="number" id="p2"  class="form-control prob" placeholder="previous Note" aria-label="previous Note" aria-describedby="basic-addon2"  min="0" max="100" disabled>
                            <div class="input-group-append">
                                <span class="input-group-text" id="basic-addon2" >0~100</span>
                                <button id="btnFix2" type="button" class="btn btn-primary btnFix" onclick="fixInput('#p2')">fix</button>
                            </div>
                        </div>

                        <label>Degree 3 (chord) (%)</label>
                        <div class="input-group sm-12 margin-main">
                            <input type="number" id="p3" class="form-control prob" placeholder="" aria-label="" aria-describedby="basic-addon2"  min="0" max="100" disabled>
                            <div class="input-group-append">
                                <span class="input-group-text" id="basic-addon2" >0~100</span>
                                <button id="btnFix3" type="button" class="btn btn-primary" onclick="fixInput('#p3')">fix</button>
                            </div>
                        </div>

                        <label>Degree 5 (chord) (%)</label>
                        <div class="input-group sm-12 margin-main">
                            <input type="number" id="p4" class="form-control prob" placeholder="" aria-label="previous Note" aria-describedby="basic-addon2"  min="0" max="100" disabled>
                            <div class="input-group-append">
                                <span class="input-group-text" id="basic-addon2" >0~100</span>
                                <button id="btnFix4" type="button" class="btn btn-primary btnFix" onclick="fixInput('#p4')">fix</button>
                            </div>
                        </div>


                        <hr>


                    </div>
                    <hr>
                    <br>

                    <h3 class="margin-main">Generator</h3>

                    <label><strong>Total probability(%)</strong></label>
                    <h3 id="totalP"></h3>

                    <label>Total notes</label>
                    <div class="input-group sm-12 margin-main ">
                        <input type="number" class="form-control" placeholder="total" id="totalNotes" aria-label="previous Note" aria-describedby="basic-addon2"  min="0" max="100" disabled>                     
                    </div>



                    <strong>Notes: </strong> <span id="scale">C D E F G A B</span> <br> 

                    <div class="margin-item2">
                        <strong class="disabled"> Random Sequence:</strong>
                        <span id="randomSeq"></span>


                    </div>




                    <button id="btnGenerate" type="button" class="btn btn-warning margin-item1 ">Generate</button>

                    <button id="play" type="button" class="btn btn-success margin-item1">Play !</button>
                    <br>


                </div>    

        </main>

        <footer>

        </footer>
    </body>
    <script src="../plugins/pianoVirtual.js"></script>
    <script>
                                    function totalProb() {
                                        var total = 0;
                                        $('.prob').each(function () {
                                            if (!$(this).val()) {
                                                return;
                                            }
                                            total += parseFloat($(this).val());
                                        })
                                        return total;
                                    }

                                    function renderTotalProb() {
                                        $('#totalP').text(totalProb());
                                    }



                                    function fixInput(idInput) {
                                        var sub = 0;
                                        var total = totalProb();
                                        if (total > 100) {
                                            sub = total - 100;
                                            var val = $(idInput).val();
                                            $(idInput).val(val - sub);

                                        } else if (total < 100) {

                                            sub = 100 - total;
                                            var val = $(idInput).val();
                                            $(idInput).val(val + sub);
                                        }
                                        renderTotalProb();

                                    }
                                    $(document).ready(function () {
                                        viewScale();

                                        $("#play").click(function () {

                                            var notesStr = $("#randomSeq").html();
                                            var notes = notesStr.split(",");
                                            var piano = Synth.createInstrument('piano');
                                            var idx = 0;
                                            var interval = setInterval(function () {
                                                piano.play((notes[idx] + "").trim(), 4, 2);
                                                idx++;
                                                if (idx >= notes.length) {
                                                    clearInterval(interval);
                                                }
                                            }, 200);
                                        });

                                        function getAllInputs() {
                                            r.probability = prob;
                                        }

                                        $('.prob').change(function () {
                                            renderTotalProb();
                                        });

                                        function viewScale() {
                                            var names = [];
                                            var options = "<option value='0'>select</option>";

                                            if (!localStorage.dataScale) {
                                                return;
                                            }
                                            var scales = JSON.parse(localStorage.dataScale);

                                            for (var i = 0; i < scales.length; i++) {

                                                var value = scales[i];


                                                var stringItem = JSON.stringify(value);

                                                options += "<option value='" + stringItem + "'>" + value.name + "</option>";
                                                console.log(options);
                                            }
                                            $("#sequence").html(options);

                                        }



                                        $("#btnEdit").click(function () {
                                            var value = $("#btnEdit").attr("value");


                                            if (value == 1) {


                                                $(".prob").each(function () {
                                                    $(this).prop("disabled", false);
                                                });
                                                $('#totalNotes').prop("disabled", false);
                                                $("#notes").prop("disabled", true);
                                                $("#sequence").prop("disabled", true);

                                                $("#btnEdit").val(0);

                                            } else {

                                                $(".prob").each(function () {
                                                    $(this).prop("disabled", true);
                                                });
                                                $('#totalNotes').prop("disabled", true);
                                                $("#notes").prop("disabled", false);
                                                $("#sequence").prop("disabled", false);
                                                $("#btnEdit").val(1);
                                            }

                                        });



                                        $("#btnGenerate").click(function () {
                                            let total = totalProb();
                                            let prob = [];
                                            let amount = $("#totalNotes").val();
                                            //var scaleKey = scale.getScaleByKey();

                                            if (total == 100) {
                                                $('#btnGenerate').removeClass('btn-warning').addClass('btn-success ');
                                                $(this).addClass('btn-success').removeClass('btn-primary ');

                                                $('.prob').each(function () {
                                                    prob.push(parseFloat($(this).val()) / 100);

                                                });
                                                console.log(prob);
                                                var totalNote = $("#totalNotes").val();

                                                var sequenceJson = JSON.parse($("#sequence").val());

                                                var scale = new Scale(sequenceJson.sequence, sequenceJson.name, $('#notes').val());
                                                var random = new RandomNotes(prob, scale);
                                                var generated = random.generateRandomNoteSequence(amount);
                                                var comma = "";
                                                var result = "";
                                                for (var i = 0; i < generated.length; i++) {
                                                    result += comma + generated[i];
                                                    comma = ", ";
                                                }
                                                $("#randomSeq").html(result);
                                            } else {
                                                alert("Sua probabilidade total deve contabilizar 100%");
                                            }
                                        })
                                    });
    </script>
</html>